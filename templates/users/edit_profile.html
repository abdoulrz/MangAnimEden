{% extends 'base.html' %}
{% load static %}

{% block title %}Modifier le profil - MangAnimEDen{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/edit_profile.css' %}?v={{ STATIC_VERSION }}">
{% endblock %}

{% block content %}
<div class="page-container">

    <!-- Page Header -->
    <div class="edit-page-header">
        <a href="{% url 'users:profile' %}" class="edit-back-link">←</a>
        <div>
            <h1 class="edit-title">Modifier le profil</h1>
            <p class="edit-subtitle">Personnalisez votre profil MangAnimEDen</p>
        </div>
    </div>

    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}

        <div class="edit-layout">

            <!-- Left Column: Form -->
            <div class="edit-form-column">

                <!-- Basic Info -->
                <div class="edit-card">
                    <div class="edit-section-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="url(#gradient-icon)" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round">
                            <defs>
                                <linearGradient id="gradient-icon" x1="0" y1="0" x2="1" y2="1">
                                    <stop offset="0%" stop-color="#7c3aed" />
                                    <stop offset="100%" stop-color="#db2777" />
                                </linearGradient>
                            </defs>
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                        <span>Informations de base</span>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Nom *</label>
                        {{ form.nickname }}
                    </div>

                    <div class="form-group">
                        <label class="form-label">Photo de profil</label>
                        <div class="edit-upload-group">
                            <div class="edit-current-avatar" id="current-avatar-preview" {% if user.avatar %}style="background-image: url('{{ user.avatar.url }}'); background-size: cover; background-position: center;" {% endif %}>
                                {% if not user.avatar %}{{ user.username|make_list|first|upper }}{% endif %}
                            </div>
                            <!-- Styled file input -->
                            <div class="edit-upload-wrapper">
                                <label class="edit-upload-label">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" class="icon-upload">
                                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                        <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                        <polyline points="21 15 16 10 5 21"></polyline>
                                    </svg>
                                    <span>Choisir une image</span>
                                    {{ form.avatar }}
                                </label>
                            </div>
                        </div>
                        <p class="edit-helper-text">PNG, JPG, JPEG (max. 2MB)</p>
                    </div>

                    <div class="form-group">
                        <label class="form-label">À propos</label>
                        {{ form.bio }}
                    </div>
                </div>



                <!-- Socials -->
                <div class="edit-card">
                    <div class="edit-section-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="url(#gradient-icon)" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round">
                            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                            <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                        </svg>
                        <span>Réseaux sociaux</span>
                    </div>
                    <p class="edit-section-subtitle">Ajoutez vos liens (optionnel)</p>

                    <div class="social-grid">
                        <div class="form-group">
                            <label class="form-label social-label">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="currentColor" class="icon-facebook">
                                    <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path>
                                </svg>
                                Facebook
                            </label>
                            {{ form.social_facebook }}
                        </div>
                        <div class="form-group">
                            <label class="form-label social-label">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="currentColor" class="icon-twitter">
                                    <path
                                        d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z">
                                    </path>
                                </svg>
                                Twitter / X
                            </label>
                            {{ form.social_twitter }}
                        </div>
                        <div class="form-group">
                            <label class="form-label social-label">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" class="icon-instagram">
                                    <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
                                    <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
                                    <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
                                </svg>
                                Instagram
                            </label>
                            {{ form.social_instagram }}
                        </div>
                        <div class="form-group">
                            <label class="form-label social-label">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="currentColor" class="icon-youtube">
                                    <path
                                        d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.33 29 29 0 0 0-.46-5.33zM9.75 15.02l5.75-3.27-5.75-3.27z">
                                    </path>
                                </svg>
                                YouTube
                            </label>
                            {{ form.social_youtube }}
                        </div>
                        <div class="form-group edit-linkedin-group">
                            <label class="form-label social-label">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="currentColor" class="icon-linkedin">
                                    <path
                                        d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z">
                                    </path>
                                    <rect x="2" y="9" width="4" height="12"></rect>
                                    <circle cx="4" cy="4" r="2"></circle>
                                </svg>
                                LinkedIn
                            </label>
                            {{ form.social_linkedin }}
                        </div>
                    </div>
                </div>

                <!-- Location -->
                <div class="edit-card">
                    <div class="edit-section-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                            stroke="url(#gradient-icon)" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                            <circle cx="12" cy="10" r="3"></circle>
                        </svg>
                        <span>Localisation</span>
                    </div>
                    <div class="social-grid">
                        <div class="form-group">
                            <label class="form-label">Pays</label>
                            {{ form.location_country }}
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ville</label>
                            {{ form.location_city }}
                        </div>
                    </div>
                </div>

                <!-- Actions -->
                <div class="form-actions">
                    <a href="{% url 'users:profile' %}" class="btn-cancel">Annuler</a>
                    <button type="submit" class="btn-save">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="btn-icon-save">
                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                            <polyline points="17 21 17 13 7 13 7 21"></polyline>
                            <polyline points="7 3 7 8 15 8"></polyline>
                        </svg>
                        Enregistrer
                    </button>
                </div>

            </div>



        </div>
    </form>
</div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const avatarInput = document.querySelector('input[name="avatar"]');
        const currentPreview = document.getElementById('current-avatar-preview');
        const stickyPreview = document.getElementById('sticky-avatar-preview');

        if (avatarInput) {
            avatarInput.addEventListener('change', function (e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();

                    reader.onload = function (e) {
                        const imageUrl = e.target.result;

                        // Update both previews
                        [currentPreview, stickyPreview].forEach(preview => {
                            if (preview) {
                                preview.style.backgroundImage = `url(${imageUrl})`;
                                preview.style.backgroundSize = 'cover';
                                preview.style.backgroundPosition = 'center';
                                preview.innerText = ''; // Clear initials
                            }
                        });
                    }

                    reader.readAsDataURL(file);
                }
            });
        }
    });
</script>
{% endblock %}