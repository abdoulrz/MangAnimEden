{% extends 'base.html' %}

{% block title %}Domaine - MangAnimEDen{% endblock %}

{% load static %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/chat.css' %}?v={{ STATIC_VERSION }}">
<link rel="stylesheet" href="{% static 'css/domaine.css' %}?v={{ STATIC_VERSION }}">
{% endblock %}

{% block content %}
<div class="chat-page-container">
    <h1 class="section-title section-title-centered">üìñ Mon Domaine</h1>

    <!-- 2-Column Layout: Center Content + Right Sidebar -->
    <div class="domaine-layout">

        <!-- Center: Dynamic Content (Fullwidth) -->
        <div class="domaine-main-content">
            <div class="glass-panel custom-scrollbar" style="padding: 2rem; min-height: 500px; max-height: 700px;">
                {% if active_mode == 'scans' %}
                <h2 class="panel-title">üìö Mes Scans</h2>
                <div class="scans-grid">
                    {% for series in scans %}
                    <a href="{% url 'catalog:detail' series.id %}" class="scan-card">
                        {% if series.cover %}
                        <img src="{{ series.cover.url }}" alt="{{ series.title }}">
                        {% else %}
                        <div class="manga-cover placeholder">
                            <span>üìö</span>
                        </div>
                        {% endif %}
                        <h4>{{ series.title }}</h4>
                    </a>
                    {% empty %}
                    <div class="empty-state-container">
                        <div class="empty-state-animation">
                            <div class="book-animation">
                                <div class="book-cover"></div>
                                <div class="book-page"></div>
                                <div class="book-page"></div>
                            </div>
                        </div>
                        <p class="empty-state-text">Aucun scan enregistr√© pour le moment.</p>
                        <p class="empty-state-subtext">Commencez √† lire pour voir vos scans ici !</p>
                    </div>
                    {% endfor %}
                </div>

                {% elif active_mode == 'favoris' %}
                <h2 class="panel-title">‚ù§Ô∏è Mes Favoris</h2>
                <div class="scans-grid">
                    {% for series in favoris %}
                    <a href="{% url 'catalog:detail' series.id %}" class="scan-card">
                        {% if series.cover %}
                        <img src="{{ series.cover.url }}" alt="{{ series.title }}">
                        {% else %}
                        <div class="manga-cover placeholder">
                            <span>‚ù§Ô∏è</span>
                        </div>
                        {% endif %}
                        <h4>{{ series.title }}</h4>
                    </a>
                    {% empty %}
                    <div class="empty-state-container">
                        <div class="empty-state-animation">
                            <div class="book-animation">
                                <div class="book-cover"></div>
                                <div class="book-page"></div>
                                <div class="book-page"></div>
                            </div>
                        </div>
                        <p class="empty-state-text">Aucun favori pour le moment.</p>
                        <p class="empty-state-subtext">Ajoutez des s√©ries √† vos favoris pour les retrouver ici !</p>
                    </div>
                    {% endfor %}
                </div>

                {% elif active_mode == 'stats' %}
                <h2 class="panel-title">üìä Statistiques de Lecture</h2>
                <div class="stats-dashboard">
                    <div class="stat-card">
                        <div class="stat-value">{{ stats.total_chapters }}</div>
                        <div class="stat-label">Chapitres lus</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">{{ stats.series_in_progress }}</div>
                        <div class="stat-label">S√©ries en cours</div>
                    </div>
                    <div class="stat-card">
                        {% if stats.finished_series > 0 %}
                        <div class="stat-value">{{ stats.finished_series }}</div>
                        {% else %}
                        <div class="stat-value" style="font-size: 2.5rem;">üöß</div>
                        {% endif %}
                        <div class="stat-label">S√©ries termin√©es</div>
                    </div>
                </div>

                {% elif active_mode == 'history' %}
                <h2 class="panel-title">üìö Historique de Lecture</h2>
                <div class="history-timeline">
                    {% for series, progress_list in series_progress.items %}
                    <div class="history-group">
                        <h3 class="series-title">{{ series.title }}</h3>
                        {% for progress in progress_list %}
                        <div class="history-item">
                            <a href="{% url 'reader:demo_chapter' progress.chapter.id %}">
                                {% if series.cover %}
                                <img src="{{ series.cover.url }}" alt="{{ series.title }}" class="history-cover">
                                {% else %}
                                <div class="history-cover placeholder"
                                    style="display:flex; justify-content:center; align-items:center; background:rgba(255,255,255,0.1); border-radius:8px;">
                                    <span>üìö</span>
                                </div>
                                {% endif %}
                                <div class="history-details">
                                    <h4>Chapitre {{ progress.chapter.number }}</h4>
                                    <span class="history-time">{{ progress.last_read|timesince }}</span>
                                </div>
                            </a>
                        </div>
                        {% endfor %}
                    </div>
                    {% empty %}
                    <p class="empty-message">Aucun historique de lecture.</p>
                    {% endfor %}
                </div>

                {% else %}
                <h2 class="panel-title">üìñ Bienvenue sur votre Domaine</h2>
                <p class="help-text">S√©lectionnez une option dans le menu √† droite pour commencer.</p>
                {% endif %}
            </div>
        </div>

        <!-- Right Sidebar: Menu Blocks -->
        <div class="domaine-sidebar">
            <div class="glass-panel sidebar-content">
                <!-- Favoris -->
                <a href="?mode=favoris" class="block-item {% if active_mode == 'favoris' %}active{% endif %}">
                    <span class="block-icon">‚ù§Ô∏è</span>
                    <span class="block-title">Favoris</span>
                </a>

                <!-- Scans -->
                <a href="?mode=scans" class="block-item {% if active_mode == 'scans' %}active{% endif %}">
                    <span class="block-icon">üìö</span>
                    <span class="block-title">Scans</span>
                </a>

                <!-- Statistiques -->
                <a href="?mode=stats" class="block-item {% if active_mode == 'stats' %}active{% endif %}">
                    <span class="block-icon">üìä</span>
                    <span class="block-title">Statistiques</span>
                </a>

                <!-- Historique -->
                <a href="?mode=history" class="block-item {% if active_mode == 'history' %}active{% endif %}">
                    <span class="block-icon">üìö</span>
                    <span class="block-title">Historique</span>
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}