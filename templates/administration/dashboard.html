{% extends "administration/base_admin.html" %}

{% block admin_content %}
<div class="admin-header">
    <h1 class="admin-page-title">Tableau de Bord</h1>
    <div class="admin-user-info">
        Connecté en tant que {{ request.user.nickname }}
        {% if request.user.role_admin %}<span class="badge badge-admin">Admin</span>{% endif %}
    </div>
</div>

<!-- Metrics Cards -->
<div class="metrics-grid">
    <div class="metric-card">
        <h3 class="metric-title">Total Utilisateurs</h3>
        <p class="metric-value primary">{{ total_users }}</p>
        <small class="metric-subtitle">+{{ new_users_today }} aujourd'hui</small>
    </div>

    <div class="metric-card">
        <h3 class="metric-title">Séries</h3>
        <p class="metric-value accent">{{ total_series }}</p>
        <small>{{ total_chapters }} chapitres</small>
    </div>

    <div class="metric-card">
        <h3 class="metric-title">Groupes</h3>
        <p class="metric-value secondary">{{ total_groups }}</p>
    </div>
</div>

<!-- Recent Activity Log -->
<div class="section-logs">
    <h2>Activité Récente (Admin & Modération)</h2>
    <table class="admin-table">
        <thead>
            <tr>
                <th>Date</th>
                <th>Auteur</th>
                <th>Action</th>
                <th>Cible</th>
                <th>Détails</th>
            </tr>
        </thead>
        <tbody>
            {% for log in recent_logs %}
            <tr>
                <td>{{ log.created_at|date:"d M H:i" }}</td>
                <td>
                    <a href="{% url 'administration:user_list' %}?q={{ log.actor.nickname }}">
                        {{ log.actor.nickname }}
                    </a>
                </td>
                <td>
                    <span class="log-action-badge">{{ log.get_action_display }}</span>
                </td>
                <td>
                    {% if log.target_user %}
                    {{ log.target_user.nickname }}
                    {% else %}
                    -
                    {% endif %}
                </td>
                <td class="text-muted">
                    {{ log.details|truncatechars:50 }}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5" class="text-center text-muted">Aucune activité récente.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}