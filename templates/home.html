{% extends 'base.html' %}

{% block title %}MangAnimEDen - Accueil{% endblock %}

{% block content %}
<div class="container home-container">

    <!-- Hero Section -->
    {% if user.is_authenticated %}
    {% if continue_reading %}
    <!-- COmpact Hero for Logged In Users -->
    <section class="hero-compact">
        <div class="hero-compact-card">
            {% if continue_reading.series.cover %}
            <img src="{{ continue_reading.series.cover.url }}" class="hero-compact-bg" alt="Hero Background">
            {% endif %}
            <div class="hero-compact-overlay"></div>

            <div class="hero-compact-content">
                <div class="hero-compact-info">
                    <span class="hero-label-sm">ğŸ“– Reprendre</span>
                    <div class="hero-text-group">
                        <h3 class="hero-title-sm">{{ continue_reading.series.title }}</h3>
                        <span class="hero-chapter-sm">Chapitre {{ continue_reading.number }}</span>
                    </div>
                </div>
                <a href="{% url 'reader:demo_chapter' continue_reading.id %}" class="btn-hero-compact">
                    Continuer <span class="arr">â†’</span>
                </a>
            </div>
        </div>
    </section>
    {% endif %}
    {% else %}
    <!-- Feature Teaser for Guests -->
    <section class="hero-guest">
        <div class="hero-guest-card">
            <div class="hero-guest-content">
                <span class="badge-feature">ğŸš€ Prochainement</span>
                <h2 class="guest-title">SystÃ¨me de Niveaux & Groupes</h2>
                <p class="guest-desc">BientÃ´t sur MangAnimEDen : CrÃ©ez votre clan, publiez des stories et gagnez de l'XP
                    Ã  chaque chapitre lu !</p>
            </div>
            <!-- Optional decoration/icon -->
            <div class="hero-guest-deco">âœ¨</div>
        </div>
    </section>
    {% endif %}

    <!-- Home Grid Layout -->
    <div class="home-grid">
        <!-- Top Left: DerniÃ¨res mises Ã  jour (3fr) -->
        <section class="home-block updates-block">
            <div class="block-header">
                <h2 class="block-title"><span>ğŸ•</span> DerniÃ¨res mises Ã  jour</h2>
                <a href="{% url 'catalog:index' %}" class="section-link">Voir tout <span>â†’</span></a>
            </div>
            <div class="block-content">
                <div class="cards-grid-3">
                    {% for series in latest_updates %}
                    <!-- Card {{ forloop.counter }} -->
                    <a href="{% url 'catalog:detail' series.id %}" class="manga-card">
                        <div class="manga-cover">
                            {% if series.cover %}
                            <img src="{{ series.cover.url }}" alt="{{ series.title }}" class="manga-image">
                            {% else %}
                            <div class="manga-image mock-cover-{{ forloop.counter }}"></div>
                            {% endif %}
                            <span class="badge-status">{{ series.get_status_display|default:"En cours" }}</span>
                            <div class="badge-rating"><span>â˜…</span> 4.5</div>
                            <span class="badge-chapter">{{ series.chapters.count }} ch.</span>
                        </div>
                        <h3 class="manga-title">{{ series.title }}</h3>
                        <p class="manga-meta">{{ series.updated_at|timesince }}</p>
                    </a>
                    {% empty %}
                    <p class="empty-text">Aucun manga rÃ©cent.</p>
                    {% endfor %}
                </div>
            </div>
        </section>

        <!-- Top Right: Ad Block -->
        <section class="home-block ad-block">
            <div class="block-content centered-content">
                <div class="ad-placeholder">
                    <div class="ad-animation">
                        <span class="ad-text">Espace Publicitaire</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Bottom Left: Populaires (3fr) -->
        <section class="home-block popular-block">
            <div class="block-header">
                <h2 class="block-title"><span>ğŸ”¥</span> Populaires en ce moment</h2>
                <a href="{% url 'catalog:index' %}" class="section-link">Voir tout <span>â†’</span></a>
            </div>
            <div class="block-content">
                <div class="cards-grid-3">
                    {% for series in popular_series %}
                    <a href="{% url 'catalog:detail' series.id %}" class="manga-card">
                        <div class="manga-cover">
                            {% if series.cover %}
                            <img src="{{ series.cover.url }}" alt="{{ series.title }}" class="manga-image">
                            {% else %}
                            <div class="manga-image mock-cover-{{ forloop.counter|add:3 }}"></div>
                            {% endif %}
                            <span class="badge-status">{{ series.get_status_display }}</span>
                            <div class="badge-rating"><span>â˜…</span> 4.9</div>
                        </div>
                        <h3 class="manga-title">{{ series.title }}</h3>
                        <p class="manga-meta">Action, Aventure</p>
                    </a>
                    {% empty %}
                    <p class="empty-text">Aucun manga populaire.</p>
                    {% endfor %}
                </div>
            </div>
        </section>

        <!-- Bottom Right: Wisdom/Quotes Block -->
        <section class="home-block ads-block">
            <div class="block-content centered-content">
                <div class="quote-container" id="wisdom-container">
                    <!-- Content injected by static/js/app.js -->
                    <noscript>
                        <p class="quote-text">"The world isn't perfect. But it's there for us, doing the best it
                            can..."</p>
                        <span class="quote-author">â€” Roy Mustang</span>
                    </noscript>
                </div>
            </div>
        </section>
    </div>

</div>

{% if not user.is_authenticated %}
<!-- CTA Banner -->
<div class="container-wide">
    {% include 'components/cta_banner.html' %}
</div>
{% endif %}
{% endblock %}