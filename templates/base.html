<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}MangAnimEDen - Lecture de manga{% endblock %}</title>
    {% load static %}
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>⛩️</text></svg>">

    <!-- Design Tokens -->
    <!-- Design Tokens -->
    <link rel="stylesheet" href="{% static 'css/tokens.css' %}?v={{ STATIC_VERSION }}&t=7">
    <link rel="stylesheet" href="{% static 'css/components.css' %}?v={{ STATIC_VERSION }}&t=7">
    <link rel="stylesheet" href="{% static 'css/pages.css' %}?v={{ STATIC_VERSION }}&t=7">
    <link rel="stylesheet" href="{% static 'css/hero.css' %}?v={{ STATIC_VERSION }}">
    <link rel="stylesheet" href="{% static 'css/detail.css' %}?v={{ STATIC_VERSION }}">


    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Merriweather:wght@400;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

    {% block extra_css %}{% endblock %}
</head>

<body>
    <!-- Navigation -->
    {% include 'components/navbar.html' %}

    <!-- Main Content -->
    <main>
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    {% include 'components/footer.html' %}

    <!-- Toast Container -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Global Scripts -->
    <script src="{% static 'js/app.js' %}?v={{ STATIC_VERSION }}"></script>

    <script>
        /**
         * Toast Notification System
         */
        function showToast(message, type = 'info', duration = 5000) {
            const container = document.getElementById('toast-container');
            if (!container) return;

            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;

            let icon = 'info-circle';
            if (type === 'success') icon = 'check-circle';
            if (type === 'error' || type === 'danger') icon = 'exclamation-circle';
            if (type === 'warning') icon = 'exclamation-triangle';

            toast.innerHTML = `
                <i class="fas fa-${icon} toast-icon"></i>
                <div class="toast-content">${message}</div>
                <button class="toast-close">&times;</button>
            `;

            container.appendChild(toast);

            // Close logic
            const closeBtn = toast.querySelector('.toast-close');
            closeBtn.onclick = () => {
                toast.classList.add('toast-exit');
                setTimeout(() => toast.remove(), 300);
            };

            // Auto-remove
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.classList.add('toast-exit');
                    setTimeout(() => toast.remove(), 300);
                }
            }, duration);
        }

        // Initialize Django messages as Toasts
        document.addEventListener('DOMContentLoaded', () => {
            const messagesData = document.getElementById('django-messages-json');
            if (messagesData) {
                const messages = JSON.parse(messagesData.textContent);
                messages.forEach(msg => showToast(msg.text, msg.tags));
            }
        });
    </script>

    {% if messages %}
    <script id="django-messages-json" type="application/json">
        [
            {% for message in messages %}
            {
                "text": "{{ message|escapejs }}",
                "tags": "{{ message.tags }}"
            }{% if not forloop.last %},{% endif %}
            {% endfor %}
        ]
    </script>
    {% endif %}

    {% block extra_js %}{% endblock %}

    <!-- Firebase SDK Initialization -->
    {% if FIREBASE_CONFIG %}
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-analytics.js";

        // Firebase configuration from Django context
        const firebaseConfig = {
            apiKey: "{{ FIREBASE_CONFIG.apiKey }}",
            authDomain: "{{ FIREBASE_CONFIG.authDomain }}",
            projectId: "{{ FIREBASE_CONFIG.projectId }}",
            storageBucket: "{{ FIREBASE_CONFIG.storageBucket }}",
            messagingSenderId: "{{ FIREBASE_CONFIG.messagingSenderId }}",
            appId: "{{ FIREBASE_CONFIG.appId }}",
            measurementId: "{{ FIREBASE_CONFIG.measurementId }}"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);

        console.log("Firebase initialized successfully");
    </script>
    {% endif %}
</body>

</html>